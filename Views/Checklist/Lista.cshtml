@model List<Vistoria_projeto.Models.ChecklistVistoria>

@{
    ViewData["Title"] = "Vistorias";
}

<script>
function concluirVistoria(id) {
    if (!confirm("Deseja marcar esta vistoria como conclu√≠da?")) return;

    // CHAMA O M√âTODO POST COM QUERY STRING
    fetch(`/Checklist/AtualizarStatus?id=${id}&novoStatus=Conclu√≠da`, {
        method: "POST"
    })
    .then(r => r.json())
    .then(res => {
        if (res.sucesso) {
            location.reload();
        } else {
            alert("Erro ao alterar status.");
        }
    })
    .catch(() => {
        alert("Erro ao alterar status.");
    });
}
</script>

<!-- T√çTULO + BOT√ïES SUPERIORES -->
<div class="d-flex justify-content-between align-items-center mt-4 mb-3">
    <h2>Vistorias</h2>

    <div>
        <a asp-action="Nova" class="btn btn-primary me-2">
            Nova Vistoria
        </a>

        <a asp-controller="Checklist" asp-action="ChecklistCompleto" class="btn btn-success">
            Checklist
        </a>
    </div>
</div>

<!-- FILTROS -->
<div class="mb-4">
    <a asp-action="Lista" asp-route-status="Todas"
       class="btn @(ViewBag.FiltroAtual == "Todas" ? "btn-primary" : "btn-outline-primary")">
        Todas
    </a>

    <a asp-action="Lista" asp-route-status="Entrada"
       class="btn @(ViewBag.FiltroAtual == "Entrada" ? "btn-primary" : "btn-outline-primary")">
        Entrada
    </a>

    <a asp-action="Lista" asp-route-status="Sa√≠da"
       class="btn @(ViewBag.FiltroAtual == "Sa√≠da" ? "btn-primary" : "btn-outline-primary")">
        Sa√≠da
    </a>
</div>

<!-- LISTA DE VISTORIAS -->
@foreach (var item in Model)
{
    <div class="card shadow-sm p-3 mb-4" style="border-radius: 12px;">

        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h5>@item.Imovel</h5>
                <small class="text-muted">
                    Respons√°vel: @item.Responsavel ‚Ä¢ @item.Data.ToString("dd/MM/yyyy HH:mm")
                </small>
            </div>

            <!-- BADGE STATUS -->
            <span class="badge
                @(item.Status == "Agendada" ? "bg-warning text-dark" :
                  item.Status == "Conclu√≠da" ? "bg-success" :
                  item.Status == "Entrada" ? "bg-primary" :
                  item.Status == "Sa√≠da" ? "bg-danger" : "bg-secondary")"
                style="font-size:14px; padding:8px 12px; border-radius:8px;">
                @item.Status
            </span>
        </div>

        <!-- BOT√ïES -->
        <div class="mt-3 d-flex gap-2">

            <!-- ‚úî Concluir -->
            <button class="btn btn-success btn-sm"
                    onclick="concluirVistoria(@item.Id)">
                ‚úî Concluir
            </button>

            <!-- üîç Ver -->
            <a asp-action="Detalhes" asp-route-id="@item.Id" class="btn btn-primary btn-sm">
                Ver
            </a>

            <!-- ‚ùå Excluir -->
            <a asp-action="Excluir" asp-route-id="@item.Id"
               class="btn btn-danger btn-sm">
                Excluir
            </a>

            <!-- üìÑ PDF -->
            <a asp-action="BaixarPDF" asp-route-id="@item.Id"
               class="btn btn-info btn-sm">
                PDF
            </a>
        </div>

    </div>
}
