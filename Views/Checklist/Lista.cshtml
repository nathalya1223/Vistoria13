@model IEnumerable<Vistoria_projeto.Models.ChecklistVistoria>
@{
    ViewData["Title"] = "Vistorias";
    var filtroAtual = ViewBag.FiltroAtual as string ?? "Todas";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<style>
    /* Estilo das etiquetas de status */
    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .status-entrada {
        background-color: #cfe2ff;
        color: #084298;
    }

    .status-saida {
        background-color: #f8d7da;
        color: #842029;
    }

    .status-concluida {
        background-color: #d1e7dd;
        color: #0f5132;
    }

    .status-agendada {
        background-color: #fff3cd;
        color: #664d03;
    }

    .status-assinada {
        background-color: #e2e3e5;
        color: #2b2f32;
    }

    .download-btn {
        border: none;
        background: none;
        color: #0d6efd;
        font-size: 1.3rem;
        transition: 0.2s;
    }

    .download-btn:hover {
        color: #084298;
        transform: scale(1.1);
    }

    /* Card mais largo e ajustado */
    .vistoria-card {
        width: 100%;
        max-width: 900px;
        margin: auto;
        border-radius: 10px;
        transition: 0.3s;
    }

    .vistoria-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 0 12px rgba(0, 0, 0, 0.15);
    }
</style>

<div class="container mt-4 mb-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h3>Vistorias</h3>
            <small class="text-muted">Gestão de vistorias de entrada e saída</small>
        </div>
        <div>
            <a asp-controller="Checklist" asp-action="Lista" class="btn btn-outline-primary">
                <i class="bi bi-clipboard-check"></i> Checklist
            </a>
            <a asp-controller="Checklist" asp-action="Nova" class="btn btn-primary ms-2">
                <i class="bi bi-plus-circle"></i> Nova Vistoria
            </a>
        </div>
    </div>

    <!-- Cards resumo -->
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="card text-center p-3 shadow-sm">
                <i class="bi bi-journal-check" style="font-size:22px; color:#0057ff;"></i>
                <h5>@ViewBag.Total</h5>
                <div class="text-muted">Total de Vistorias</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center p-3 shadow-sm">
                <i class="bi bi-check-circle" style="font-size:22px; color:#1f7a4c;"></i>
                <h5>@ViewBag.Concluidas</h5>
                <div class="text-muted">Concluídas</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center p-3 shadow-sm">
                <i class="bi bi-calendar-event" style="font-size:22px; color:#8a6d3b;"></i>
                <h5>@ViewBag.Agendadas</h5>
                <div class="text-muted">Agendadas</div>
            </div>
        </div>
    </div>

    <!-- Filtros -->
    <div class="mb-3">
        <a asp-controller="Checklist" asp-action="Lista" asp-route-status="Todas"
           class="btn @(filtroAtual=="Todas" ? "btn-primary" : "btn-outline-secondary") me-1">Todas</a>
        <a asp-controller="Checklist" asp-action="Lista" asp-route-status="Entrada"
           class="btn @(filtroAtual=="Entrada" ? "btn-primary" : "btn-outline-secondary") me-1">Entrada</a>
        <a asp-controller="Checklist" asp-action="Lista" asp-route-status="Saída"
           class="btn @(filtroAtual=="Saída" ? "btn-primary" : "btn-outline-secondary")">Saída</a>
    </div>

    <!-- Lista de Vistorias -->
    @if (Model == null || !Model.Any())
    {
        <div class="alert alert-info text-center">
            Nenhum checklist cadastrado ainda.
        </div>
    }
    else
    {
        <div class="d-flex flex-column align-items-center gap-3">
            @foreach (var item in Model)
            {
                var statusClass = item.Status switch
                {
                    "Entrada" => "status-entrada",
                    "Saída" => "status-saida",
                    "Concluída" => "status-concluida",
                    "Agendada" => "status-agendada",
                    "Assinada" => "status-assinada",
                    _ => "status-assinada"
                };

                <div class="card vistoria-card p-3 shadow-sm d-flex flex-row align-items-center justify-content-between">
                    <div>
                        <h5 class="mb-1">@item.Imovel</h5>
                        <p class="mb-1"><strong>Responsável:</strong> @item.Responsavel</p>
                        <p class="mb-0"><strong>Data:</strong> @item.Data.ToString("dd/MM/yyyy") • @item.Horario</p>
                    </div>

                    <div class="d-flex align-items-center gap-3">
                        <!-- Status com ícone -->
                        <div class="status-badge @statusClass">
                            <i class="bi bi-file-earmark-text"></i> @item.Status
                        </div>

                        <!-- Botão de download funcional -->
                        <a asp-controller="Checklist" asp-action="BaixarPDF" asp-route-id="@item.Id"
                           class="download-btn" title="Baixar vistoria em PDF">
                            <i class="bi bi-download"></i>
                        </a>

                        <!-- Botão Ver -->
                        <a asp-controller="Checklist" asp-action="Detalhes" asp-route-id="@item.Id"
                           class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-eye"></i> Ver
                        </a>

                        <!-- Botão Excluir -->
                        <form asp-controller="Checklist" asp-action="Excluir" asp-route-id="@item.Id" method="post" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-outline-danger"
                                    onclick="return confirm('Tem certeza que deseja excluir esta vistoria?');">
                                <i class="bi bi-trash"></i> Excluir
                            </button>
                        </form>
                    </div>
                </div>
            }
        </div>
    }
</div>
